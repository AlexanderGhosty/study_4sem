<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>JSON Storage Example</title>
</head>
<body>
<h1>Список элементов (Items)</h1>
<div>
    <button onclick="loadItems()">Загрузить список</button>
</div>
<br />
<table id="itemsTable" border="1" cellpadding="5" cellspacing="0">
    <thead>
    <tr>
        <th>ID</th>
        <th>Имя (Name)</th>
        <th>Описание (Description)</th>
    </tr>
    </thead>
    <tbody>
    <!-- Содержимое таблицы будет загружаться динамически -->
    </tbody>
</table>

<hr/>

<h2>Добавить новый элемент</h2>
<form onsubmit="return addItem(event)">
    <label>Имя: <input type="text" id="addName" required></label><br><br>
    <label>Описание: <input type="text" id="addDescription"></label><br><br>
    <button type="submit">Добавить</button>
</form>

<hr/>

<h2>Обновить элемент (по ID)</h2>
<form onsubmit="return updateItem(event)">
    <label>ID: <input type="number" id="updID" required></label><br><br>
    <label>Имя: <input type="text" id="updName" required></label><br><br>
    <label>Описание: <input type="text" id="updDescription"></label><br><br>
    <button type="submit">Обновить</button>
</form>

<script>
    // Функция загрузки списка элементов (GET /items)
    function loadItems() {
        fetch('/items')
            .then(response => response.json())
            .then(data => {
                const tbody = document.querySelector('#itemsTable tbody');
                tbody.innerHTML = ''; // очищаем таблицу

                data.forEach(item => {
                    const row = document.createElement('tr');

                    const cellID = document.createElement('td');
                    cellID.textContent = item.id;
                    row.appendChild(cellID);

                    const cellName = document.createElement('td');
                    cellName.textContent = item.name;
                    row.appendChild(cellName);

                    const cellDesc = document.createElement('td');
                    cellDesc.textContent = item.description;
                    row.appendChild(cellDesc);

                    tbody.appendChild(row);
                });
            })
            .catch(err => {
                alert("Ошибка при загрузке: " + err);
            });
    }

    // Функция добавления нового элемента (POST /items)
    function addItem(event) {
        event.preventDefault(); // чтобы страница не перезагружалась

        const nameValue = document.getElementById('addName').value;
        const descValue = document.getElementById('addDescription').value;

        const newItem = {
            name: nameValue,
            description: descValue
        };

        fetch('/items', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(newItem)
        })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text); });
                }
                return response.json();
            })
            .then(createdItem => {
                alert('Добавлен объект с ID: ' + createdItem.id);
                // Очистим форму + перезагрузим список
                document.getElementById('addName').value = '';
                document.getElementById('addDescription').value = '';
                loadItems();
            })
            .catch(err => {
                alert("Ошибка при добавлении: " + err);
            });

        return false;
    }

    // Функция обновления элемента (PUT /items/{id})
    function updateItem(event) {
        event.preventDefault();

        const updIDValue = document.getElementById('updID').value;
        const updNameValue = document.getElementById('updName').value;
        const updDescValue = document.getElementById('updDescription').value;

        const updatedData = {
            name: updNameValue,
            description: updDescValue
        };

        fetch('/items/' + updIDValue, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updatedData)
        })
            .then(response => {
                if (response.status === 404) {
                    throw new Error("Элемент не найден");
                }
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text); });
                }
                return response.json();
            })
            .then(updatedList => {
                alert('Успешно обновлено. Список перезагружен.');
                // Возвращаемый объект - это весь список (по примеру)
                const tbody = document.querySelector('#itemsTable tbody');
                tbody.innerHTML = '';

                updatedList.forEach(item => {
                    const row = document.createElement('tr');

                    const cellID = document.createElement('td');
                    cellID.textContent = item.id;
                    row.appendChild(cellID);

                    const cellName = document.createElement('td');
                    cellName.textContent = item.name;
                    row.appendChild(cellName);

                    const cellDesc = document.createElement('td');
                    cellDesc.textContent = item.description;
                    row.appendChild(cellDesc);

                    tbody.appendChild(row);
                });
            })
            .catch(err => {
                alert("Ошибка при обновлении: " + err);
            });

        return false;
    }
</script>
</body>
</html>
